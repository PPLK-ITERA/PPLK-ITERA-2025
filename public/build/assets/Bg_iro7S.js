import{r as e,W as s,j as t,a,y as r}from"./CULJX-LD.js";import{J as i,Q as o}from"./BEqJyIUO.js";import{D as n}from"./srWRE0_7.js";import{b as c}from"./DbtZxEEj.js";import{T as d}from"./B-KXWwRc.js";import{u as m}from"./Xzcqpchp.js";import{u as l}from"./Ch9upq7Y.js";import"./BazlAVUM.js";import"./DFwIZlGs.js";import"./Cd1KtWgy.js";import"./Do30OntR.js";import"./B8fFxIsl.js";import"./3pMHw_2Z.js";import"./BYWBB09O.js";import"./JZVQJDgZ.js";import"./Ciw0daNj.js";import"./CUgZZUVH.js";import"./C0u18CNn.js";import"./uSVsvbP2.js";function u({auth:u}){const{toast:j}=m(),[f,p]=e.useState(""),[h,x]=e.useState(""),[v,w]=e.useState(""),[y,b]=e.useState(!1);s({qr_code:""});return e.useEffect((()=>{(async()=>{try{const e=await fetch(route("csrf")),s=await e.json();p(s.csrfToken)}catch(e){console.error("Error fetching CSRF token:",e)}})()}),[]),l(),t.jsxs(t.Fragment,{children:[t.jsx(n,{user:u.user,children:t.jsxs("div",{className:"relative flex flex-col items-center justify-center w-full h-full",children:[t.jsxs("div",{className:"md:w-[100%] w-[75vw] h-[70vh] items-center justify-center",children:[t.jsx("h2",{className:"text-xl font-bold tracking-tight text-center mb-4",children:"QR Scanner - Log Komdis"}),y?t.jsx("div",{className:"border-b-purple-900 flex items-center justify-center w-full h-full",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-2"}),t.jsx("p",{children:"Memproses QR Code..."})]})}):t.jsx("div",{className:"flex items-center justify-center w-full",children:t.jsx("div",{className:"md:w-64",children:t.jsx(i,{onScan:function(e){var s;const t=null==(s=e.at(-1))?void 0:s.rawValue;t&&((async e=>{if(e){b(!0);try{const s=await fetch(`/dashboard/komdis/create?qr_code=${encodeURIComponent(e)}`,{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":f}}),t=await s.json();t.success?(j({title:"Mahasiswa Ditemukan",variant:"default",description:`${t.data.name} - ${t.data.nim}`}),setTimeout((()=>{r.get(route("dashboard.komdis.index"),{userData:JSON.stringify(t.data),redirectToInput:!0})}),1500)):j({title:"Mahasiswa Tidak Ditemukan",variant:"destructive",description:t.message||"QR Code tidak terdaftar dalam sistem"})}catch(s){console.error("Error:",s),j({title:"Error",variant:"destructive",description:"Terjadi kesalahan saat memproses QR code"})}b(!1)}})(t),x(t))},components:{finder:!0,tracker:o,zoom:!0},allowMultiple:!0,scanDelay:2e3,paused:y,styles:{container:{width:"100%"}}})})})]}),t.jsxs("div",{className:"flex flex-col items-center gap-3 mt-4",children:[t.jsx(a,{href:route("dashboard.komdis.index"),className:c(),children:"Input Manual"}),h&&t.jsxs("p",{className:"md:block hidden text-sm text-gray-600",children:["Last Scanned: ",h.substring(0,50),h.length>50?"...":""]})]})]})}),t.jsx(d,{})]})}export{u as default};
