{"version":3,"file":"DxtqVbkq.js","sources":["../../../resources/js/Pages/Mading/Pengumpulan/Page.tsx"],"sourcesContent":["import { set } from \"date-fns\";\nimport { useDebouncedCallback } from \"use-debounce\";\n\nimport React, { useEffect, useState } from \"react\";\n\nimport { Link, router, useForm } from \"@inertiajs/react\";\n\nimport { ChevronLeft } from \"lucide-react\";\n\nimport DefaultLayout from \"@/Layouts/DefaultLayout\";\n\nimport MaxWidthWrapper from \"@/Components/MaxWidthWrapper\";\nimport { Button, buttonVariants } from \"@/Components/ui/button\";\nimport { Input } from \"@/Components/ui/input\";\nimport { Label } from \"@/Components/ui/label\";\nimport { Toaster } from \"@/Components/ui/toaster\";\nimport { useToast } from \"@/Components/ui/use-toast\";\n\nimport { TaskData } from \"@/lib/types/Mading\";\n\nexport default function Page({ id }) {\n    const [tugasData, setTugasData] = useState<TaskData | null>(null);\n    const [urlError, setUrlError] = useState(new Map());\n    const [csrfToken, setCsrfToken] = useState(\"\");\n\n    const { toast } = useToast();\n\n    const {\n        data: formData,\n        setData: setFormData,\n        post,\n        put,\n        processing,\n        errors,\n    } = useForm<{\n        tugas_id: number[];\n        jawaban: string[];\n    }>({\n        tugas_id: [],\n        jawaban: [],\n    });\n\n    // Update tugas_id and jawaban arrays\n    const addOrUpdateTugasId = (index, value) => {\n        const newTugasId = [...formData.tugas_id];\n        newTugasId[index] = value;\n        setFormData(\"tugas_id\", newTugasId);\n    };\n\n    const addOrUpdateJawaban = (index, value) => {\n        const newJawaban = [...formData.jawaban];\n        newJawaban[index] = value;\n        setFormData(\"jawaban\", newJawaban);\n    };\n\n    // Function to remove a value from tugas_id array\n    const removeTugasId = (index) => {\n        const newTugasId = formData.tugas_id.filter((_, i) => i !== index); // Filter out the value\n        setFormData(\"tugas_id\", newTugasId); // Update the form data\n    };\n\n    // Function to remove a value from jawaban array\n    const removeJawaban = (index) => {\n        const newJawaban = formData.jawaban.filter((_, i) => i !== index); // Filter out the value\n        setFormData(\"jawaban\", newJawaban); // Update the form data\n    };\n\n    const getTugasData = async () => {\n        try {\n            const response = await fetch(route(\"mading.tugas\", { id }), {\n                method: \"GET\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                },\n            });\n\n            if (!response.ok) {\n                throw new Error(\"HTTP status \" + response.status);\n            }\n\n            const data = await response.json();\n            setTugasData(data);\n\n            let tugasId: number[] = [];\n            data.tugas.forEach((tugas, index) => {\n                tugasId.push(tugas.id);\n                addOrUpdateJawaban(index, \"\");\n            });\n            setFormData(\"tugas_id\", tugasId);\n        } catch (error) {\n            toast({\n                title: \"Error\",\n                description: \"Gagal mendapatkan data tugas\",\n                variant: \"destructive\",\n            });\n        }\n    };\n\n    useEffect(() => {\n        getTugasData();\n\n        const fetchCsrfToken = async () => {\n            try {\n                const response = await fetch(route(\"csrf\"));\n                const data = await response.json();\n                setCsrfToken(data.csrfToken);\n            } catch (error) {\n                console.error(\"Error fetching CSRF token:\", error);\n            }\n        };\n\n        fetchCsrfToken();\n    }, []);\n\n    const validateUrl = (\n        tipe_link: string,\n        tugas_id: number,\n        url: string,\n        index: number,\n    ) => {\n        switch (tipe_link) {\n            case \"tiktok\":\n                validateTiktokUrl(tugas_id, url, index);\n                break;\n            case \"instagram\":\n                validateInstagramUrl(tugas_id, url, index);\n                break;\n            case \"drive\":\n                validateGDriveUrl(tugas_id, url, index);\n                break;\n        }\n    };\n\n    // Function to check if all URLs are valid\n    const allLinksValid = () => {\n        for (const [key, value] of urlError.entries()) {\n            if (value !== \"\") {\n                return false;\n            }\n        }\n        return true;\n    };\n\n    const validateTiktokUrl = useDebouncedCallback((tugas_id, url, index) => {\n        if (!/^https:\\/\\/(www\\.)?tiktok\\.com\\/.*$/g.test(url)) {\n            setUrlError(\n                new Map(urlError).set(tugas_id, \"link harus dari TikTok\"),\n            );\n            return;\n        }\n\n        setUrlError(new Map(urlError).set(tugas_id, \"\"));\n        addOrUpdateJawaban(index, url); // Update jawaban\n    }, 200);\n\n    const validateInstagramUrl = useDebouncedCallback(\n        async (tugas_id, url, index) => {\n            if (!/^https:\\/\\/(www\\.)?instagram\\.com\\/.*$/g.test(url)) {\n                setUrlError(\n                    new Map(urlError).set(\n                        tugas_id,\n                        \"link harus dari Instagram\",\n                    ),\n                );\n                return;\n            }\n\n            setUrlError(new Map(urlError).set(tugas_id, \"\"));\n            addOrUpdateJawaban(index, url); // Update jawaban\n        },\n        200,\n    );\n\n    const validateGDriveUrl = useDebouncedCallback(\n        async (tugas_id, url, index) => {\n            if (!/^https:\\/\\/(www\\.)?\\w+\\.google\\.com\\/.*$/g.test(url)) {\n                setUrlError(\n                    new Map(urlError).set(\n                        tugas_id,\n                        \"link harus dari Google Drive\",\n                    ),\n                );\n                return;\n            }\n\n            let id = url.split(\"/\")[5];\n\n            let response = await fetch(\n                `https://www.googleapis.com/drive/v2/files/${id}?key=${import.meta.env.VITE_GOOGLE_API_KEY}`,\n            );\n\n            if (!response.ok) {\n                setUrlError(\n                    new Map(urlError).set(\n                        tugas_id,\n                        \"Link drive belum publik, silahkan coba lagi\",\n                    ),\n                );\n\n                return;\n            }\n\n            setUrlError(new Map(urlError).set(tugas_id, \"\"));\n            addOrUpdateJawaban(index, url); // Update jawaban\n        },\n        200,\n    );\n\n    const handleSubmit = async () => {\n        try {\n            const response = await fetch(route(\"mading.store\"), {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"X-CSRF-TOKEN\": csrfToken,\n                },\n                body: JSON.stringify({\n                    tugas_id: formData.tugas_id,\n                    jawaban: formData.jawaban,\n                }),\n            });\n\n            if (!response.ok) {\n                throw new Error(\"HTTP status \" + response.status);\n            }\n\n            router.replace(route(\"mading\"));\n        } catch (error) {\n            toast({\n                title: \"Error\",\n                description: \"Gagal mensubmit tugas\",\n                variant: \"destructive\",\n            });\n        }\n    };\n\n    return (\n        <>\n            <DefaultLayout isSolid={true}>\n                <div className=\"bg-pattern-white pt-28\">\n                    <MaxWidthWrapper className=\"min-h-screen\">\n                        <div className=\"px-2.5 bg-white/80 py-5 rounded-md md:px-5 lg:px-10 xl:px-28\">\n                            <Link\n                                href={route(\"mading\")}\n                                className={`${buttonVariants({ variant: \"outline\" })} bg-transparent hover:bg-transparent shadow-none items-center border-none flex gap-2 -ml-5`}\n                            >\n                                <ChevronLeft />\n                                <span>Kembali</span>\n                            </Link>\n                            <h2\n                                data-aos=\"fade-down\"\n                                data-aos-duration=\"1000\"\n                                className=\"font-montserrat font-bold text-jaffa-700 w-fit pt-[30px] text-3xl\"\n                            >\n                                Pengumpulan Tugas Day - {id}\n                            </h2>\n\n                            <div className=\"flex flex-col mt-10\">\n                                {tugasData?.tugas.map((tugas, index) => (\n                                    <div className=\"flex flex-col\" key={index}>\n                                        <Label\n                                            htmlFor=\"input-tugas\"\n                                            className=\"text-left capitalize\"\n                                        >\n                                            Link {tugas.tipe_link}\n                                        </Label>\n\n                                        <Input\n                                            type=\"text\"\n                                            id=\"input-tugas\"\n                                            onChange={(e) => {\n                                                validateUrl(\n                                                    tugas.tipe_link,\n                                                    tugas.id,\n                                                    e.target.value,\n                                                    index,\n                                                );\n                                            }}\n                                            placeholder={\n                                                tugas.tipe_link === \"tiktok\"\n                                                    ? \"https://www.tiktok.com/...\"\n                                                    : tugas.tipe_link ===\n                                                        \"instagram\"\n                                                      ? \"https://www.instagram.com/...\"\n                                                      : tugas.tipe_link ===\n                                                          \"drive\"\n                                                        ? \"https://drive.google.com/...\"\n                                                        : \"Yeuu gaada kocakkkkk!\"\n                                            }\n                                            className=\"mt-2\"\n                                        />\n                                        {urlError.get(tugas.id) ? (\n                                            <span className=\"text-red-500 text-[12px]\">\n                                                {urlError.get(tugas.id)}\n                                            </span>\n                                        ) : urlError.get(tugas.id) === \"\" ? (\n                                            <span className=\"text-[12px] text-green-500\">\n                                                Link valid\n                                            </span>\n                                        ) : null}\n                                    </div>\n                                ))}\n\n                                <Button\n                                    onClick={handleSubmit}\n                                    disabled={\n                                        !allLinksValid() ||\n                                        !formData.jawaban.length\n                                    }\n                                    className=\"bg-jaffa-700 hover:bg-jaffa-700/90 w-full mt-5 transition duration-200 ease-in-out\"\n                                >\n                                    Submit Tugas {id}\n                                </Button>\n                            </div>\n                        </div>\n                    </MaxWidthWrapper>\n                </div>\n            </DefaultLayout>\n\n            <Toaster />\n        </>\n    );\n}\n"],"names":["Page","id","tugasData","setTugasData","useState","urlError","setUrlError","Map","csrfToken","setCsrfToken","toast","useToast","data","formData","setData","setFormData","post","put","processing","errors","useForm","tugas_id","jawaban","addOrUpdateJawaban","index","value","newJawaban","useEffect","async","response","fetch","route","method","headers","ok","Error","status","json","tugasId","tugas","forEach","push","error","title","description","variant","console","validateTiktokUrl","useDebouncedCallback","url","test","set","validateInstagramUrl","validateGDriveUrl","split","jsxRuntimeExports","jsxs","Fragment","children","jsx","DefaultLayout","isSolid","className","MaxWidthWrapper","Link","href","buttonVariants","ChevronLeft","map","Label","htmlFor","tipe_link","Input","type","onChange","e","validateUrl","target","placeholder","get","Button","onClick","body","JSON","stringify","yt","replace","disabled","key","entries","allLinksValid","length","Toaster"],"mappings":"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"}